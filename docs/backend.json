{
  "entities": {
    "Provider": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Provider",
      "type": "object",
      "description": "Represents a provider in the system, storing their core registration and profile information.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Provider entity."
        },
        "providerType": {
          "type": "array",
          "description": "Define si el proveedor es de Bienes, Servicios (Contratista), o ambos.",
          "items": {
            "type": "string",
            "enum": [
              "Bienes",
              "Servicios (Contratista)"
            ]
          }
        },
        "documentType": {
          "type": "string",
          "description": "Type of document used for identification (e.g., NIT, CC)."
        },
        "documentNumber": {
          "type": "string",
          "description": "The provider's document number."
        },
        "businessName": {
          "type": "string",
          "description": "The legal business name or individual name of the provider."
        },
        "city": {
          "type": "string",
          "description": "The city where the provider is located."
        },
        "department": {
          "type": "string",
          "description": "The department or state where the provider is located."
        },
        "country": {
          "type": "string",
          "description": "The country where the provider is located."
        },
        "address": {
          "type": "string",
          "description": "The physical address of the provider."
        },
        "email": {
          "type": "string",
          "description": "The email address of the provider, used for login and communication.",
          "format": "email"
        },
        "rutFileUrl": {
          "type": "string",
          "description": "URL of the RUT file stored in cloud storage.",
          "format": "uri"
        },
        "camaraComercioFileUrl": {
          "type": "string",
          "description": "URL of the Camara de Comercio (Chamber of Commerce) file stored in cloud storage.",
          "format": "uri"
        },
        "cedulaRepresentanteLegalFileUrl": {
          "type": "string",
          "description": "URL of the Cedula (ID) of the legal representative file stored in cloud storage.",
          "format": "uri"
        },
        "certificacionBancariaFileUrl": {
          "type": "string",
          "description": "URL of the Certificacion Bancaria (Bank Certification) file stored in cloud storage.",
          "format": "uri"
        },
        "estadosFinancierosFileUrl": {
          "type": "string",
          "description": "URL of the Estados Financieros (Financial Statements) file stored in cloud storage.",
          "format": "uri"
        },
        "declaracionRentaFileUrl": {
          "type": "string",
          "description": "URL of the Declaracion de Renta (Tax Declaration) file stored in cloud storage.",
          "format": "uri"
        },
        "sarlaftAccepted": {
          "type": "boolean",
          "description": "Indicates whether the provider has accepted the SARLAFT terms and conditions."
        },
        "formLocked": {
          "type": "boolean",
          "description": "If true, the provider's form is locked and cannot be edited."
        },
        "disabled": {
          "type": "boolean",
          "description": "If true, the provider's account is disabled and they cannot log in."
        },
        "taxRegimeType": {
          "type": "string",
          "description": "Type of tax regime (e.g., Simplificado, Común)."
        },
        "isLargeTaxpayer": {
          "type": "string",
          "description": "Whether the provider is a large taxpayer (Sí/No)."
        },
        "largeTaxpayerResolution": {
          "type": "string",
          "description": "Resolution number if a large taxpayer."
        },
        "isIncomeSelfRetainer": {
          "type": "string",
          "description": "Whether the provider is an income self-retainer (Sí/No)."
        },
        "incomeSelfRetainerResolution": {
          "type": "string",
          "description": "Resolution number if an income self-retainer."
        },
        "isIcaSelfRetainer": {
          "type": "string",
          "description": "Whether the provider is an ICA self-retainer (Sí/No)."
        },
        "icaSelfRetainerMunicipality": {
          "type": "string",
          "description": "Municipality for ICA self-retention."
        },
        "icaSelfRetainerResolution": {
          "type": "string",
          "description": "Resolution number if an ICA self-retainer."
        },
        "ciiuCode": {
          "type": "string",
          "description": "CIIU economic activity code."
        },
        "icaCode": {
          "type": "string",
          "description": "ICA economic activity code."
        },
        "declarationCity": {
          "type": "string",
          "description": "City where taxes are declared."
        },
        "icaPercentage": {
          "type": "string",
          "description": "ICA percentage."
        },
        "implementsEnvironmentalMeasures": {
          "type": "string",
          "description": "Whether the provider implements environmental measures (Sí/No)."
        },
        "environmentalMeasuresDescription": {
          "type": "string",
          "description": "Description of the environmental measures implemented by the provider."
        },
        "legalRepresentativeName": {
          "type": "string",
          "description": "Name of the legal representative."
        },
        "legalRepresentativeDocumentType": {
          "type": "string",
          "description": "Document type of the legal representative (e.g., CC, CE, Pasaporte)."
        },
        "legalRepresentativeDocumentNumber": {
          "type": "string",
          "description": "Document number of the legal representative."
        },
        "bankName": {
          "type": "string",
          "description": "Name of the banking entity."
        },
        "accountType": {
          "type": "string",
          "description": "Type of bank account (e.g., Ahorros, Corriente)."
        },
        "accountNumber": {
          "type": "string",
          "description": "Bank account number."
        },
        "beneficiaryName": {
          "type": "string",
          "description": "Name of the bank account holder."
        },
        "categoryIds": {
          "type": "array",
          "description": "An array of category IDs to which this provider belongs.",
          "items": {
            "type": "string"
          }
        },
        "hseqSgsst": {
          "type": "string",
          "description": "Indicates if the company has an SG-SST in accordance with Decree 1072, with an evaluation result of resolution 0312/19, above 60% (Sí/No)."
        },
        "nitLoginMigrated": {
          "type": "boolean",
          "description": "If true, the provider's auth account has been migrated to use NIT for login."
        }
      },
      "required": [
        "id",
        "providerType",
        "documentType",
        "documentNumber",
        "businessName",
        "city",
        "department",
        "country",
        "address",
        "email",
        "sarlaftAccepted",
        "bankName",
        "accountType",
        "accountNumber",
        "beneficiaryName"
      ]
    },
    "AdminUser": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AdminUser",
      "type": "object",
      "description": "Represents an administrator user account.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the AdminUser entity."
        },
        "email": {
          "type": "string",
          "description": "Email address of the admin user. Used for login.",
          "format": "email"
        }
      },
      "required": [
        "id",
        "email"
      ]
    },
    "Evaluation": {
      "title": "Evaluation",
      "type": "object",
      "description": "Stores an evaluation record for a provider or contractor.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the evaluation."
        },
        "providerId": {
          "type": "string",
          "description": "ID of the provider being evaluated."
        },
        "evaluatorId": {
          "type": "string",
          "description": "ID of the admin who performed the evaluation."
        },
        "evaluatorName": {
          "type": "string",
          "description": "Name of the admin who performed the evaluation."
        },
        "evaluationType": {
          "type": "string",
          "enum": [
            "provider_performance",
            "contractor_evaluation"
          ]
        },
        "scores": {
          "type": "object",
          "description": "Object containing scores for each criterion."
        },
        "totalScore": {
          "type": "number",
          "description": "The final weighted score."
        },
        "comments": {
          "type": "string",
          "description": "Additional comments or notes."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time"
        },
        "evidenceFileUrl": {
          "type": "string",
          "format": "uri",
          "description": "URL to a supporting document like a quotation PDF."
        },
        "fracttalOrderIds": {
          "type": "string",
          "description": "A list of comma-separated Fracttal order IDs for a performance evaluation."
        }
      },
      "required": [
        "id",
        "providerId",
        "evaluatorId",
        "evaluationType",
        "scores",
        "totalScore",
        "createdAt"
      ]
    },
    "Category": {
      "title": "Category",
      "type": "object",
      "description": "Represents a category for grouping providers.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the category."
        },
        "name": {
          "type": "string",
          "description": "The name of the category."
        },
        "description": {
          "type": "string",
          "description": "A brief description of the category."
        },
        "categoryType": {
          "type": "string",
          "description": "The type of provider this category applies to.",
          "enum": [
            "Bienes",
            "Servicios (Contratista)"
          ]
        }
      },
      "required": [
        "id",
        "name",
        "categoryType"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "providers/{providerId}",
        "definition": {
          "entityName": "Provider",
          "schema": {
            "$ref": "#/backend/entities/Provider"
          },
          "description": "Stores information for each provider. Provider can only access their own document.  The {providerId} MUST match the authenticated user's UID. No denormalization required as access control is based on path and UID.",
          "params": [
            {
              "name": "providerId",
              "description": "The UID of the provider, matching the authenticated user's ID."
            }
          ]
        }
      },
      {
        "path": "providers/{providerId}/evaluations/{evaluationId}",
        "definition": {
          "entityName": "Evaluation",
          "schema": {
            "$ref": "#/backend/entities/Evaluation"
          },
          "description": "Stores evaluation records for a specific provider. Only admins can access.",
          "params": [
            {
              "name": "providerId",
              "description": "The UID of the provider."
            },
            {
              "name": "evaluationId",
              "description": "The unique ID for the evaluation record."
            }
          ]
        }
      },
      {
        "path": "roles_admin/{adminId}",
        "definition": {
          "entityName": "AdminUser",
          "schema": {
            "$ref": "#/backend/entities/AdminUser"
          },
          "description": "Stores the IDs of admin users. Existence of a document at this path grants admin privileges. No data other than the document ID is required.",
          "params": [
            {
              "name": "adminId",
              "description": "The UID of an administrator user."
            }
          ]
        }
      },
      {
        "path": "categories/{categoryId}",
        "definition": {
          "entityName": "Category",
          "schema": {
            "$ref": "#/backend/entities/Category"
          },
          "description": "Stores all provider categories. Only admins can read and write.",
          "params": [
            {
              "name": "categoryId",
              "description": "The unique ID for the category record."
            }
          ]
        }
      }
    ],
    "reasoning": "This design prioritizes security and scalability for the Gestión de Proveedores application, focusing on Authorization Independence and clear data segregation.  The core entities are `Provider`, `AdminUser`, and `Evaluation`. Providers self-register and manage their information. Admins have read-only access to provider data and full control over evaluations. The `evaluations` are stored as a subcollection under each provider for clear data ownership and efficient querying.\\n\\n**Authorization Independence:**  The `providers/{providerId}` collection relies on the `request.auth.uid` being equal to the `{providerId}` to ensure providers can only access their own data. The `evaluations` subcollection is restricted to admins only.\\n\\n**QAPs (Rules are not Filters):**\\n*   Secure `list` operations are supported for admins on the `providers` collection. Providers cannot list other providers. Admins can list evaluations for a specific provider.\\n*   The `roles_admin/{uid}` collection uses \"existence over content\", simply checking if a document exists to grant admin privileges. This is a secure and scalable approach.\\n\\n**Invariants:**\\n*   Ownership:  The `providers/{providerId}` path ensures that each provider can only manage their own data, determined by their `uid`. Evaluations are owned by the system and managed by admins.\\n*   Data Integrity:  The schemas define the required fields, ensuring consistent data structures.\\n\\n**Denormalization:** No explicit denormalization is required in this structure, as Authorization Independence is achieved through the path-based ownership of provider documents."
  }
}
